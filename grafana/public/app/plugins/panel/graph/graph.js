/*! grafana - v4.0.2-1481203731 - 2016-12-08
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["jquery.flot","jquery.flot.selection","jquery.flot.time","jquery.flot.stack","jquery.flot.stackpercent","jquery.flot.fillbelow","jquery.flot.crosshair","./jquery.flot.events","angular","jquery","moment","lodash","app/core/utils/kbn","./graph_tooltip","./threshold_manager"],function(a){var b,c,d,e,f,g,h,i,j;return{setters:[function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){b=a},function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a},function(a){g=a},function(a){h=a}],execute:function(){i=b["default"].module("grafana.directives"),j={},i.directive("grafanaGraph",["$rootScope","timeSrv",function(a,b){return{restrict:"A",template:"",link:function(a,i){function k(a){if(!I.legend.show||I.legend.rightSide)return 0;if(I.legend.alignAsTable){var b=e["default"].filter(C,function(a){return a.hideFromLegend(I.legend)===!1}),c=23+21*b.length;return Math.min(c,Math.floor(a/2))}return 26}function l(){try{var a=G.height-k(G.height);return i.css("height",a+"px"),!0}catch(b){return console.log(b),!1}}function m(){return!C||(!l()||(0===L||void 0))}function n(a,b){var c=j[a];return c||(c=j[a]=b.width()),c}function o(b){for(var d=b.getYAxes(),g=0;g<C.length;g++){var h=C[g],j=d[h.yaxis-1],k=f["default"].valueFormats[I.yaxes[h.yaxis-1].format];if(e["default"].isNumber(I.decimals))h.updateLegendValues(k,I.decimals,null);else{var l=(j.tickDecimals||-1)+1;h.updateLegendValues(k,l,j.scaledDecimals+2)}K.$$phase||a.$digest()}if(I.yaxes[0].label){var m=c["default"]("<div class='axisLabel left-yaxis-label flot-temp-elem'></div>").text(I.yaxes[0].label).appendTo(i);m[0].style.marginTop=n(I.yaxes[0].label,m)/2+"px"}if(I.yaxes[1].label){var o=c["default"]("<div class='axisLabel right-yaxis-label flot-temp-elem'></div>").text(I.yaxes[1].label).appendTo(i);o[0].style.marginTop=n(I.yaxes[1].label,o)/2+"px"}M.draw(b)}function p(a,b){var c=I.yaxes[0],d=I.yaxes[1];c.show&&c.label&&(b.left=20),d.show&&d.label&&(b.right=20);for(var e=a.getYAxes(),f=0;f<e.length;f++){var g=e[f],h=I.yaxes[f];g.options.max=h.max,g.options.min=h.min}}function q(a){for(var b=Number.MAX_VALUE,c=0;c<a.length;c++)a[c].stats.timeStep&&a[c].stats.timeStep<b&&(b=a[c].stats.timeStep);return b}function r(){function a(a){try{F=c["default"].plot(i,E,d),G.renderError&&(delete G.error,delete G.inspector)}catch(b){console.log("flotcharts error",b),G.error=b.message||"Render Error",G.renderError=!0,G.inspector={error:b}}a&&G.renderingCompleted()}if(L=i.width(),!m()){M.prepare(i,C);for(var b=!!I.stack||null,d={hooks:{draw:[o],processOffset:[p]},legend:{show:!1},series:{stackpercent:!!I.stack&&I.percentage,stack:I.percentage?null:b,lines:{show:I.lines,zero:!1,fill:s(I.fill),lineWidth:I.linewidth,steps:I.steppedLine},bars:{show:I.bars,fill:1,barWidth:1,zero:!1,lineWidth:0},points:{show:I.points,fill:1,fillColor:!1,radius:I.points?I.pointradius:2},shadowSize:0},yaxes:[],xaxis:{},grid:{minBorderMargin:0,markings:[],backgroundColor:null,borderWidth:0,hoverable:!0,color:"#c8c8c8",margin:{left:0,right:0}},selection:{mode:"x",color:"#666"},crosshair:{mode:I.tooltip.shared||H.sharedCrosshair?"x":null}},f=0;f<C.length;f++){var g=C[f];g.data=g.getFlotPairs(g.nullPointMode||I.nullPointMode),G.hiddenSeries[g.alias]&&(g.data=[],g.stack=!1)}switch(I.xaxis.mode){case"series":d.series.bars.barWidth=.7,d.series.bars.align="center";for(var f=0;f<C.length;f++){var g=C[f];g.data=[[f+1,g.stats[I.xaxis.values[0]]]]}v(d);break;case"table":d.series.bars.barWidth=.7,d.series.bars.align="center",w(d);break;default:d.series.bars.barWidth=q(C)/1.5,u(d)}M.addPlotOptions(d,I),x(d),y(C,d),E=e["default"].sortBy(C,function(a){return a.zindex}),t(I)?(a(!1),setTimeout(function(){a(!0)},50),J=I.legend.rightSide):a(!0)}}function s(a){return 0===a?.001:a/10}function t(a){return!!a.legend.rightSide||(null!==J&&a.legend.rightSide!==J||void 0)}function u(a){var b=L/100,c=e["default"].isUndefined(G.range.from)?null:G.range.from.valueOf(),d=e["default"].isUndefined(G.range.to)?null:G.range.to.valueOf();a.xaxis={timezone:H.getTimezone(),show:I.xaxis.show,mode:"time",min:c,max:d,label:"Datetime",ticks:b,timeformat:B(b,c,d)}}function v(a){var b=e["default"].map(C,function(a,b){return[b+1,a.alias]});a.xaxis={timezone:H.getTimezone(),show:I.xaxis.show,mode:null,min:0,max:b.length+1,label:"Datetime",ticks:b}}function w(a){var b=e["default"].map(C,function(a,b){return e["default"].map(a.datapoints,function(c,d){var e=b*a.datapoints.length+d;return[e+1,c[1]]})});b=e["default"].flatten(b,!0),a.xaxis={timezone:H.getTimezone(),show:I.xaxis.show,mode:null,min:0,max:b.length+1,label:"Datetime",ticks:b}}function x(a){if(D&&0!==D.length){var b={};b.$__alerting={color:"rgba(237, 46, 24, 1)",position:"BOTTOM",markerSize:5},b.$__ok={color:"rgba(11, 237, 50, 1)",position:"BOTTOM",markerSize:5},b.$__no_data={color:"rgba(150, 150, 150, 1)",position:"BOTTOM",markerSize:5},b.$__execution_error=["$__no_data"];for(var c=0;c<D.length;c++){var d=D[c];d.newState?(console.log(d.newState),d.eventType="$__"+d.newState):b[d.source.name]||(b[d.source.name]={color:d.source.iconColor,position:"BOTTOM",markerSize:5})}a.events={levels:e["default"].keys(b).length+1,data:D,types:b}}}function y(a,b){var c={position:"left",show:I.yaxes[0].show,index:1,logBase:I.yaxes[0].logBase||1,max:null};if(b.yaxes.push(c),e["default"].find(a,{yaxis:2})){var d=e["default"].clone(c);d.index=2,d.show=I.yaxes[1].show,d.logBase=I.yaxes[1].logBase||1,d.position="right",b.yaxes.push(d),z(b.yaxes[1],a),A(b.yaxes[1],I.percentage&&I.stack?"percent":I.yaxes[1].format)}z(b.yaxes[0],a),A(b.yaxes[0],I.percentage&&I.stack?"percent":I.yaxes[0].format)}function z(a,b){if(1!==a.logBase){var c,d,e=a.max;if(null===e){for(d=0;d<b.length;d++)c=b[d],c.yaxis===a.index&&e<c.stats.max&&(e=c.stats.max);void 0===e&&(e=Number.MAX_VALUE)}a.min=null!==a.min?a.min:0,a.ticks=[0,1];for(var f=1;;)if(f*=a.logBase,a.ticks.push(f),f>e)break;10===a.logBase?(a.transform=function(a){return Math.log(a+.1)},a.inverseTransform=function(a){return Math.pow(10,a)}):(a.transform=function(b){return Math.log(b+.1)/Math.log(a.logBase)},a.inverseTransform=function(b){return Math.pow(a.logBase,b)})}}function A(a,b){a.tickFormatter=function(a,c){return f["default"].valueFormats[b](a,c.tickDecimals,c.scaledDecimals)}}function B(a,b,c){if(b&&c&&a){var d=c-b,e=d/a/1e3,f=864e5,g=31536e6;return e<=45?"%H:%M:%S":e<=7200||d<=f?"%H:%M":e<=8e4?"%m/%d %H:%M":e<=2419200||d<=g?"%m/%d":"%Y-%m"}return"%H:%M"}var C,D,E,F,G=a.ctrl,H=G.dashboard,I=G.panel,J=null,K=a.$root,L=0,M=new h.ThresholdManager(G);G.events.on("panel-teardown",function(){M=null,F&&(F.destroy(),F=null)}),K.onAppEvent("setCrosshair",function(b,c){c.scope!==a&&H.sharedCrosshair&&F&&F.setCrosshair({x:c.pos.x,y:c.pos.y})},a),K.onAppEvent("clearCrosshair",function(){F&&F.clearCrosshair()},a),G.events.on("render",function(a){C=a||C,C&&(D=G.annotations,r())});var N=new g["default"](i,H,a,function(){return E});i.bind("plotselected",function(c,e){a.$apply(function(){b.setTime({from:d["default"].utc(e.xaxis.from),to:d["default"].utc(e.xaxis.to)})})}),a.$on("$destroy",function(){N.destroy(),i.off(),i.remove()})}}}])}}});